<!doctype html>
<meta charset="utf-8" />
<title>Claim</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>html,body{height:100%}body{margin:0;display:grid;place-items:center;background:#0f172a;color:#fff;font:14px system-ui}</style>
<div>設定中…</div>
<script>
(async () => {
  // NFCタグ: /claim.html#ip=...&cara=...（? でもOK）
  const qs = location.hash.slice(1) || location.search.slice(1);
  const sp = new URLSearchParams(qs);
  const ip = sp.get('ip'), cara = sp.get('cara');

  // URLからパラメータをまず消す（漏洩防止）
  history.replaceState(null, '', '/');

  if (!ip || !cara) { location.replace('/'); return; }

  // サーバへ POST → サーバが HttpOnly Cookie を設定
  try {
    await fetch('/api/claim', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ ip, cara }),
    });
  } catch {}

  // ホームへ
  location.replace('/');
})();
</script>
