<!doctype html>
<meta charset="utf-8" />
<title>Claim</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>html,body{height:100%}body{margin:0;display:grid;place-items:center;background:#0f172a;color:#fff;font:14px system-ui}</style>
<div>設定中…</div>
<script>
(async () => {
  // NFCタグ: /claim.html#ip=...&cara=... もしくは ?ip=...&cara=...
  const qs = location.hash.slice(1) || location.search.slice(1);
  const sp = new URLSearchParams(qs);
  const ip = sp.get('ip'), cara = sp.get('cara');

  // まずURLからパラメータを隠す（漏洩防止）
  history.replaceState(null, '', '/');

  if (!ip || !cara) { location.replace('/'); return; }

  // CacheStorage にプロフィールを書き込む（SW不要）
  try {
    const cache = await caches.open('oshi-profile-v1');
    await cache.put('/__profile__/current',
      new Response(JSON.stringify({ ip, cara }), {
        headers: { 'Content-Type': 'application/json' }
      })
    );
  } catch (e) { /* 失敗してもそのまま遷移 */ }

  // ホームへ
  location.replace('/');
})();
</script>
